<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <title>Capacitor WASM PoC</title>
  <meta name="viewport"
    content="viewport-fit=cover,width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <link rel="icon" type="image/x-icon" href="./assets/icon/favicon.ico" />
  <link rel="manifest" href="./manifest.json" />
  <script src="wasm_exec.js"></script>
  <link rel="stylesheet" href="./css/style.css" />
  <!-- <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> -->
  <script type="module">
    import { is_loggedin, supabase_logout, supabase_login, fetch_country, update_country, delete_country, create_country} from './js/supabase.js'
    window.is_loggedin = is_loggedin;
    window.supabase_login = supabase_login;
    window.supabase_logout = supabase_logout;
    window.db_op = {
      fetch_country,
      update_country,
      delete_country,
      create_country
    }

    const go = new Go();
    WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
      go.run(result.instance);
      is_loggedin()
      // delete_country()
      // create_country()
      // fetch_country()
    });
  </script>

  <script>
    function makeScriptsExecutable(el) {
      el.querySelectorAll("script").forEach(script => {
        const clone = document.createElement("script")

        for (const attr of script.attributes) {
          clone.setAttribute(attr.name, attr.value)
        }

        clone.text = script.innerHTML
        script.remove()
        document.head.appendChild(clone)
      })
    }

    function render_app(path, arg0) {
        const temp_body = document.createElement('body');
        temp_body.innerHTML = go_wasm_handler(path, arg0);
        makeScriptsExecutable(temp_body)
        document.documentElement.replaceChild(temp_body, document.body);
    }

    function render_test(args) {
      const {key, ...rest} = args
      render_app(key, JSON.stringify(rest))
    }
  </script>
</head>

<body>
  
</body>

</html>