<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <title>Capacitor WASM PoC</title>
  <meta name="viewport"
    content="viewport-fit=cover,width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <link rel="icon" type="image/x-icon" href="./assets/icon/favicon.ico" />
  <link rel="manifest" href="./manifest.json" />
  <script src="wasm_exec.js"></script>
  <link rel="stylesheet" href="./css/style.css" />
  <script>
    const go = new Go();
    WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
      go.run(result.instance);
      // render_app("fuel-load")
    });
  </script>
  <script>
    function makeScriptsExecutable(el) {
      el.querySelectorAll("script").forEach(script => {
        const clone = document.createElement("script")

        for (const attr of script.attributes) {
          clone.setAttribute(attr.name, attr.value)
        }

        clone.text = script.innerHTML
        script.remove()
        document.head.appendChild(clone)
      })
    }

    function render_app(path) {
      if (go_wasm_handler) {
        const temp_body = document.createElement('div');
        temp_body.innerHTML = go_wasm_handler(path);
        makeScriptsExecutable(temp_body)
        document.documentElement.replaceChild(temp_body, document.body);
      }
    }

    function click_menu(e) {
      console.log(e.target.textContent)
      // if (go_wasm_handler) {
      //   const temp_div = document.createElement('div');
      //   temp_div.innerHTML = go_wasm_handler(path);
      //   makeScriptsExecutable(temp_div)
      //   document.querySelector('#app-content').innerHTML = temp_div.firstChild

      // }
    }
  </script>
</head>

<body>
  <div class="py-safe h-screen flex flex-col">
    <div class="drawer grow">
      <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content flex flex-col">
        <!-- Navbar -->
        <div class="w-full navbar">
          <div class="flex-none">
            <label for="my-drawer-3" aria-label="open sidebar" class="btn btn-square btn-ghost">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                class="inline-block w-6 h-6 stroke-current">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                </path>
              </svg>
            </label>
          </div>
          <div class="flex-1 px-2 mx-2" id="title"></div>
        </div>
        <section class="p-8 grow shrink-0 basis-auto">
          <main class="min-h-[90%]" id="app-content">
          </main>
        </section>
      </div>
      <div class="drawer-side py-safe">
        <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
        <ul class="menu p-4 w-80 min-h-full bg-base-200 text-base-content">
          <li><button onclick={click_menu}>Fuel Load</button></li>
          <li><button onclick={click_menu}>Takeoff mins</button></li>
        </ul>
      </div>
    </div>
  </div>
</body>

</html>